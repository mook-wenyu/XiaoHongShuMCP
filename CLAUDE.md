# CLAUDE.md - XiaoHongShuMCP é¡¹ç›®æŒ‡å—

è¿™æ˜¯ä¸€ä¸ªåŸºäº .NET 8.0 å’Œ Model Context Protocol (MCP) çš„å°çº¢ä¹¦æ™ºèƒ½è‡ªåŠ¨åŒ–æœåŠ¡å™¨å®ç°ã€‚

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

XiaoHongShuMCP æ˜¯ä¸€ä¸ªä¸“ä¸ºå°çº¢ä¹¦(XiaoHongShu)å¹³å°è®¾è®¡çš„ MCP æœåŠ¡å™¨ï¼Œæä¾›æ™ºèƒ½è‡ªåŠ¨åŒ–åŠŸèƒ½ï¼š

### æ ¸å¿ƒç‰¹æ€§
- **ğŸ” å®‰å…¨ä¼˜å…ˆ**: æ‰€æœ‰å†…å®¹æ“ä½œä»…ä¿å­˜ä¸ºè‰ç¨¿ï¼Œä¸æ”¯æŒè‡ªåŠ¨å‘å¸ƒ
- **ğŸš€ å¯åŠ¨å³ç”¨**: MCPæœåŠ¡å™¨å¯åŠ¨æ—¶è‡ªåŠ¨è¿æ¥æµè§ˆå™¨å¹¶éªŒè¯ç™»å½•çŠ¶æ€
- **ğŸ¤– æ™ºèƒ½æœç´¢**: æ”¯æŒå¤šç»´åº¦ç­›é€‰çš„å¢å¼ºæœç´¢åŠŸèƒ½
- **ğŸ“Š æ•°æ®åˆ†æ**: è‡ªåŠ¨ç»Ÿè®¡åˆ†æå’Œ Excel å¯¼å‡º
- **ğŸ‘¤ æ‹ŸäººåŒ–äº¤äº’**: æ¨¡æ‹ŸçœŸäººæ“ä½œæ¨¡å¼ï¼Œé˜²æ£€æµ‹æœºåˆ¶
- **ğŸ”§ å®Œæ•´æµ‹è¯•**: 69+ ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œ100% é€šè¿‡ç‡
- **ğŸ§© é€šç”¨APIç›‘å¬**: å…¨æ–°çš„UniversalApiMonitoræ”¯æŒå¤šç«¯ç‚¹ç›‘å¬
- **ğŸ”„ æ™ºèƒ½æ•°æ®è½¬æ¢**: ä¸“é—¨çš„APIæ•°æ®è½¬æ¢å™¨å’Œæ¨¡å‹ç³»ç»Ÿ

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒæŠ€æœ¯æ ˆ
- **.NET 8.0**: LTS ç‰ˆ .NET æ¡†æ¶ï¼Œæ”¯æŒç°ä»£ C# ç‰¹æ€§
- **Model Context Protocol 0.3.0-preview.4**: MCP åè®®å®ç°
- **Microsoft Playwright 1.54.0**: æµè§ˆå™¨è‡ªåŠ¨åŒ–å¼•æ“
- **Serilog**: ç»“æ„åŒ–æ—¥å¿—è®°å½•
- **NPOI 2.7.4**: Excel æ–‡ä»¶æ“ä½œ
- **NUnit 4.4.0**: å•å…ƒæµ‹è¯•æ¡†æ¶

### é¡¹ç›®ç»“æ„
```
XiaoHongShuMCP/
â”œâ”€â”€ XiaoHongShuMCP.sln              # Visual Studio è§£å†³æ–¹æ¡ˆ
â”œâ”€â”€ XiaoHongShuMCP/                 # ä¸»é¡¹ç›®
â”‚   â”œâ”€â”€ Program.cs                  # ç¨‹åºå…¥å£ï¼ˆå†…ç½®é»˜è®¤é…ç½® + è¦†ç›–æœºåˆ¶ï¼‰
â”‚   â”œâ”€â”€ XiaoHongShuMCP.csproj      # é¡¹ç›®æ–‡ä»¶å’Œä¾èµ–ç®¡ç†
â”‚   â”œâ”€â”€ Services/                   # æœåŠ¡å±‚å®ç°
â”‚   â”‚   â”œâ”€â”€ Interfaces.cs           # æ¥å£å®šä¹‰å’Œæ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ AccountManager.cs       # è´¦å·ç®¡ç†æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ PlaywrightBrowserManager.cs # æµè§ˆå™¨ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ DomElementManager.cs    # DOM é€‰æ‹©å™¨ä¸å…ƒç´ ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ HumanizedInteraction/   # æ‹ŸäººåŒ–äº¤äº’æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ HumanizedInteractionService.cs # ä¸»äº¤äº’æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ DelayManager.cs     # æ™ºèƒ½å»¶æ—¶ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ ElementFinder.cs    # é«˜çº§å…ƒç´ æŸ¥æ‰¾
â”‚   â”‚   â”‚   â”œâ”€â”€ SmartTextSplitter.cs # æ™ºèƒ½æ–‡æœ¬åˆ†å‰²
â”‚   â”‚   â”‚   â””â”€â”€ TextInputStrategies.cs # æ–‡æœ¬è¾“å…¥ç­–ç•¥
â”‚   â”‚   â”œâ”€â”€ BrowserConnectionHostedService.cs # åå°è‡ªåŠ¨è¿æ¥æœåŠ¡
â”‚   â”‚   â””â”€â”€ XiaoHongShuService.cs   # å°çº¢ä¹¦æ ¸å¿ƒæœåŠ¡
â”‚   â””â”€â”€ Tools/
â”‚       â””â”€â”€ XiaoHongShuTools.cs     # MCP å·¥å…·é›†å®šä¹‰
â”œâ”€â”€ Tests/                          # æµ‹è¯•é¡¹ç›®
â”‚   â”œâ”€â”€ XiaoHongShuMCP.Tests.csproj # æµ‹è¯•é¡¹ç›®é…ç½®
â”‚   â”œâ”€â”€ Services/                   # æœåŠ¡å±‚æµ‹è¯•
â”‚   â”œâ”€â”€ Models/                     # æ•°æ®æ¨¡å‹æµ‹è¯•
â”‚   â”œâ”€â”€ Tools/                      # MCP å·¥å…·æµ‹è¯•
â”‚   â””â”€â”€ README.md                   # æµ‹è¯•æ–‡æ¡£
â”œâ”€â”€ logs/                          # æ—¥å¿—æ–‡ä»¶ç›®å½•
â””â”€â”€ exports/                       # æ•°æ®å¯¼å‡ºç›®å½•
```

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. é€šç”¨APIç›‘å¬ç³»ç»Ÿ (UniversalApiMonitor)
- **å¤šç«¯ç‚¹æ”¯æŒï¼ˆç‰ˆæœ¬æ— å…³ï¼‰**: Homefeed(æ¨è) `/api/sns/web/v{N}/homefeed`ã€Feed(ç¬”è®°è¯¦æƒ…) `/api/sns/web/v{N}/feed`ã€SearchNotes(æœç´¢) `/api/sns/web/v{N}/search/notes`ã€Comments(è¯„è®º) `/api/sns/web/v{N}/comment/page`
- **æ™ºèƒ½è·¯ç”±**: æ ¹æ®URLæ¨¡å¼è‡ªåŠ¨è¯†åˆ«APIç±»å‹ï¼Œè·¯ç”±åˆ°å¯¹åº”å¤„ç†å™¨
- **å“åº”å¤„ç†**: HomefeedResponseProcessorã€FeedResponseProcessorã€SearchNotesResponseProcessorã€CommentsResponseProcessor
- **æ•°æ®ç»Ÿä¸€**: å°†ä¸åŒAPIæ ¼å¼ç»Ÿä¸€è½¬æ¢ä¸ºNoteDetailæ¨¡å‹
- **å®æ—¶ç›‘æ§**: æ”¯æŒå®æ—¶ç›‘æ§APIå“åº”å’Œæ•°æ®æå–

### 2. æ™ºèƒ½æ”¶é›†æ§åˆ¶å™¨ (SmartCollectionController)
- **APIé›†æˆ**: å®Œå…¨é›†æˆUniversalApiMonitorï¼Œåˆ é™¤äº†å†…åµŒç®€é™‹ç›‘å¬ç³»ç»Ÿ
- **ä¾èµ–æ³¨å…¥**: ä½¿ç”¨ç°ä»£DIæ¨¡å¼ï¼Œæé«˜ä»£ç å¯æµ‹è¯•æ€§å’Œç»´æŠ¤æ€§
- **æ”¶é›†ç­–ç•¥**: æ”¯æŒå¿«é€Ÿã€æ ‡å‡†ã€è°¨æ…ä¸‰ç§æ¨¡å¼ï¼Œé€‚åº”ä¸åŒåœºæ™¯
- **æ•°æ®åˆå¹¶**: æ™ºèƒ½åˆå¹¶APIæ•°æ®å’Œé¡µé¢æ•°æ®ï¼Œé¿å…é‡å¤è®¡æ•°
- **æ€§èƒ½ç›‘æ§**: å†…ç½®æ€§èƒ½ç›‘æ§å’Œæ•ˆç‡è¯„åˆ†ç³»ç»Ÿ

### 3. Feed APIæ•°æ®å¤„ç†ç³»ç»Ÿ
- **FeedApiConverter**: ä¸“é—¨çš„APIæ•°æ®è½¬æ¢å™¨ï¼Œå¤„ç†æ—¶é—´æˆ³ã€å›¾ç‰‡ã€äº¤äº’æ•°æ®è½¬æ¢
- **FeedApiModels**: å®Œæ•´çš„APIå“åº”æ•°æ®æ¨¡å‹ï¼Œå¼ºç±»å‹å’ŒJSONæ˜ å°„æ”¯æŒ
- ï¼ˆå·²ç”± UniversalApiMonitor ç»Ÿä¸€æ¥ç®¡ä¸“ç”¨ç›‘å¬é€»è¾‘ï¼‰
- **æ•°æ®éªŒè¯**: å†…ç½®æ•°æ®æœ‰æ•ˆæ€§æ£€æŸ¥å’Œé”™è¯¯å¤„ç†æœºåˆ¶

### 4. æ¨èæœåŠ¡ç³»ç»Ÿ (RecommendService)ï¼ˆå·²åˆå¹¶è‡³ XiaoHongShuServiceï¼‰
- **æ™ºèƒ½æ¨è**: åŸºäºç”¨æˆ·è¡Œä¸ºå’Œå†…å®¹è´¨é‡çš„æ™ºèƒ½æ¨èç®—æ³•
- **å¤šæ¸ é“æ•°æ®**: ç»¼åˆé¦–é¡µæ¨èã€çƒ­é—¨å†…å®¹ç­‰å¤šæ¸ é“æ•°æ®
- **å®æ—¶æ›´æ–°**: å®æ—¶è·å–æœ€æ–°æ¨èå†…å®¹å’Œè¶‹åŠ¿åˆ†æ

### 5. å…¥å£é¡µå®ˆæŠ¤ (PageStateGuard)
- **æ™ºèƒ½å¯¼èˆª**: è‡ªåŠ¨è¯†åˆ«å’Œå¯¼èˆªåˆ°å‘ç°é¡µé¢çš„ä¸åŒç‰ˆå—
- **é¡µé¢éªŒè¯**: éªŒè¯å¯¼èˆªç»“æœå’Œé¡µé¢åŠ è½½çŠ¶æ€
- **å®¹é”™å¤„ç†**: å¤„ç†é¡µé¢ç»“æ„å˜åŒ–å’Œç½‘ç»œå¼‚å¸¸æƒ…å†µ

### 6. è´¦å·ç®¡ç† (AccountManager)
- æµè§ˆå™¨ä¼šè¯è¿æ¥å’ŒéªŒè¯
- **Cookie ç™»å½•æ£€æµ‹**: åŸºäº `web_session` cookie çš„å¯é ç™»å½•çŠ¶æ€æ£€æµ‹
- ç”¨æˆ·ä¿¡æ¯æå–å’ŒéªŒè¯
- æ”¯æŒä¸ªäººé¡µé¢å®Œæ•´æ•°æ®è·å–

### 7. æ™ºèƒ½æœç´¢ (SearchDataService)
- **å¤šç»´åº¦ç­›é€‰**: æ”¯æŒæ’åºã€ç±»å‹ã€æ—¶é—´ã€èŒƒå›´ç­‰ç­›é€‰
- **ç»Ÿè®¡åˆ†æ**: è‡ªåŠ¨è®¡ç®—æ•°æ®è´¨é‡ã€å¹³å‡äº’åŠ¨ç­‰æŒ‡æ ‡
- **æ‰¹é‡å¤„ç†**: æ™ºèƒ½æ‰¹é‡è·å–ç¬”è®°è¯¦æƒ…
- **æ•°æ®å¯¼å‡º**: è‡ªåŠ¨ç”Ÿæˆ Excel æŠ¥å‘Š

### 8. å†…å®¹ç®¡ç† (XiaoHongShuService)
- **è‰ç¨¿ä¿å­˜**: ä»…æ”¯æŒè‰ç¨¿æ¨¡å¼ï¼Œç¡®ä¿ç”¨æˆ·æ§åˆ¶
- **ç¬”è®°è¯¦æƒ…**: è·å–å®Œæ•´ç¬”è®°ä¿¡æ¯ï¼ˆå›¾ç‰‡ã€è§†é¢‘ã€è¯„è®ºï¼‰
- **è¯„è®ºåŠŸèƒ½**: æ”¯æŒå‘å¸ƒè¯„è®ºäº’åŠ¨
- **ç±»å‹è¯†åˆ«**: è‡ªåŠ¨è¯†åˆ«å›¾æ–‡ã€è§†é¢‘ã€é•¿æ–‡ç±»å‹

### 9. æµè§ˆå™¨è‡ªåŠ¨åŒ– (PlaywrightBrowserManager)
- è¿æ¥ç°æœ‰æµè§ˆå™¨ä¼šè¯ (ç«¯å£ 9222)
- æ— å¤´/æœ‰å¤´æ¨¡å¼æ”¯æŒ
- ä¼šè¯ç®¡ç†å’Œèµ„æºé‡Šæ”¾
- **Cookie ç™»å½•æ£€æµ‹**: é€šè¿‡ `web_session` cookie éªŒè¯ç™»å½•çŠ¶æ€

### 10. åå°è‡ªåŠ¨è¿æ¥æœåŠ¡ (BrowserConnectionHostedService)
- **å¯åŠ¨æ—¶è‡ªåŠ¨è¿æ¥**: MCPæœåŠ¡å™¨å¯åŠ¨åè‡ªåŠ¨å°è¯•è¿æ¥æµè§ˆå™¨
- **çŠ¶æ€éªŒè¯**: è‡ªåŠ¨æ£€æŸ¥æµè§ˆå™¨è¿æ¥å’Œå°çº¢ä¹¦ç™»å½•çŠ¶æ€
- **å‹å¥½åé¦ˆ**: æä¾›è¯¦ç»†çš„è¿æ¥çŠ¶æ€æ—¥å¿—ä¿¡æ¯
- **éé˜»å¡å¯åŠ¨**: è¿æ¥è¿‡ç¨‹ä¸å½±å“MCPæœåŠ¡å™¨æ­£å¸¸å¯åŠ¨
- **è‡ªåŠ¨å¯¼èˆª**: è¿æ¥æµè§ˆå™¨æˆåŠŸåï¼Œè‡ªåŠ¨å¯¼èˆªåˆ° `BaseUrl`ï¼ˆé»˜è®¤ `https://www.xiaohongshu.com/explore`ï¼‰

### 11. æ‹ŸäººåŒ–äº¤äº’ç³»ç»Ÿ (HumanizedInteraction)
å…¨æ–°é‡æ„çš„æ‹ŸäººåŒ–äº¤äº’ç³»ç»Ÿï¼Œé‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼š
- **HumanizedInteractionService**: ä¸»äº¤äº’æœåŠ¡åè°ƒè€…
- **DelayManager**: æ™ºèƒ½å»¶æ—¶ç®¡ç†ï¼Œæä¾›å¤šç§å»¶æ—¶ç­–ç•¥
- **ElementFinder**: é«˜çº§å…ƒç´ æŸ¥æ‰¾ï¼Œæ”¯æŒå¤šçº§å®¹é”™é€‰æ‹©å™¨
- **SmartTextSplitter**: æ™ºèƒ½æ–‡æœ¬åˆ†å‰²ï¼Œæ¨¡æ‹ŸçœŸäººè¾“å…¥æ¨¡å¼
- **TextInputStrategies**: å¤šç§è‡ªç„¶æ–‡æœ¬è¾“å…¥ç­–ç•¥

### 12. é€‰æ‹©å™¨ç®¡ç† (SelectorManager)
- å¤šçº§å®¹é”™ CSS é€‰æ‹©å™¨
- åŠ¨æ€é€‰æ‹©å™¨æ›´æ–°
- åŸºäºçœŸå® HTML ç»“æ„ä¼˜åŒ–
- åˆ«åæ˜ å°„ç³»ç»Ÿ

## âš™ï¸ ç«¯ç‚¹ç›‘å¬ä¸é‡è¯•ç­–ç•¥

ç»Ÿä¸€çš„ç«¯ç‚¹ç­‰å¾…-é‡è¯•æœºåˆ¶é€‚ç”¨äºä»¥ä¸‹æ“ä½œï¼š

- æœç´¢ï¼š`GetSearchNotes`
- æ¨èï¼š`GetRecommendedNotes`
- è¯¦æƒ…ï¼š`GetNoteDetail`
- æ‰¹é‡ï¼š`BatchGetNoteDetails`
- æ”¶é›†ï¼š`SmartCollectionController.ExecuteSmartCollectionAsync`

é…ç½®é¡¹ï¼ˆ`EndpointRetry`ï¼‰ï¼š
- `AttemptTimeoutMs`ï¼šå•æ¬¡ç­‰å¾…ç«¯ç‚¹å‘½ä¸­çš„è¶…æ—¶ï¼ˆé»˜è®¤ 120000 æ¯«ç§’ï¼‰
- `MaxRetries`ï¼šè¶…æ—¶åæœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œä¸å«é¦–æ¬¡ï¼ˆé»˜è®¤ 3ï¼‰

å…³é”®è¡Œä¸ºï¼ˆLast Retry â†’ Go Homeï¼‰ï¼š
- åœ¨â€œæœ€åä¸€æ¬¡é‡è¯•â€ä¹‹å‰ï¼ŒæœåŠ¡ä¼šå…ˆå¼ºåˆ¶è·³è½¬åˆ°ä¸»é¡µï¼ˆå‘ç°é¡µï¼‰ï¼Œå†æ‰§è¡Œå¯¹åº”æ“ä½œæˆ–ç›´æ¥ç­‰å¾…ç«¯ç‚¹å‘½ä¸­ï¼Œä»¥åˆ·æ–° SPA ä¸Šä¸‹æ–‡å¹¶å‡å°‘è„çŠ¶æ€å½±å“ã€‚
- æœç´¢/æ‰¹é‡åœ¨æœ€åä¸€è½®ä¼šè·³è¿‡äºŒæ¬¡å¯¼èˆªï¼ˆé¿å…é‡å¤ï¼‰ï¼Œç›´æ¥åœ¨ä¸»é¡µæ‰§è¡Œè¾“å…¥ä¸æäº¤ï¼›æ¨èåœ¨æœ€åä¸€è½®ç›´æ¥ç­‰å¾… Homefeed å‘½ä¸­ã€‚

è¦†ç›–æ–¹å¼ï¼ˆæ ¹èŠ‚ XHSï¼‰ï¼š
- ç¯å¢ƒå˜é‡ï¼š`XHS__EndpointRetry__AttemptTimeoutMs`ã€`XHS__EndpointRetry__MaxRetries`
- å‘½ä»¤è¡Œï¼š`XHS:EndpointRetry:AttemptTimeoutMs=... XHS:EndpointRetry:MaxRetries=...`

ä¸ `McpSettings:WaitTimeoutMs` çš„å…³ç³»ï¼š
- `McpSettings:WaitTimeoutMs` æ˜¯æ•´ä½“å…œåº•ç­‰å¾…ï¼›`EndpointRetry` æ§åˆ¶æ¯è½®ç«¯ç‚¹ç­‰å¾…ä¸é‡è¯•æ¬¡æ•°ï¼Œä¸¤è€…äº’è¡¥ã€‚

## ğŸ› ï¸ å¼€å‘ç¯å¢ƒé…ç½®

### ç³»ç»Ÿè¦æ±‚
- **.NET 8.0 SDK** æˆ–æ›´é«˜ç‰ˆæœ¬
- **Visual Studio 2022** æˆ– **JetBrains Rider**
- **Chrome/Edge æµè§ˆå™¨** (è¿œç¨‹è°ƒè¯•æ”¯æŒ)
- **Windows 10/11** æˆ– **macOS/Linux**

### æµè§ˆå™¨é…ç½®
ç”¨æˆ·éœ€è¦å¯ç”¨æµè§ˆå™¨è¿œç¨‹è°ƒè¯•ï¼š

```bash
# Chrome å¯åŠ¨å‚æ•°
chrome.exe --remote-debugging-port=9222

# Edge å¯åŠ¨å‚æ•°  
msedge.exe --remote-debugging-port=9222
```

### å¼€å‘å‘½ä»¤

#### æ„å»ºå’Œè¿è¡Œ
```bash
# æ¢å¤ä¾èµ–
dotnet restore

# æ„å»ºé¡¹ç›®
dotnet build

# è¿è¡Œå¼€å‘æ¨¡å¼
dotnet run --project XiaoHongShuMCP

# è¿è¡Œç”Ÿäº§æ¨¡å¼
dotnet run --project XiaoHongShuMCP --configuration Release
```

#### æµ‹è¯•ç›¸å…³
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
dotnet test Tests

# è¿è¡Œç‰¹å®šæµ‹è¯•
dotnet test Tests --filter "ClassName=DomElementManagerTests"

# è¯¦ç»†æµ‹è¯•è¾“å‡º
dotnet test Tests --verbosity normal
```

#### å‘å¸ƒéƒ¨ç½²
```bash
# å‘å¸ƒ Windows ç‰ˆæœ¬
dotnet publish -c Release -r win-x64 --self-contained

# å‘å¸ƒ macOS ç‰ˆæœ¬
dotnet publish -c Release -r osx-x64 --self-contained
```

## ğŸ“‹ MCP å·¥å…·é›†

é¡¹ç›®é€šè¿‡ `XiaoHongShuTools` ç±»æš´éœ²ä»¥ä¸‹ MCP å·¥å…·ï¼š

### æµè§ˆå™¨è¿æ¥å·¥å…·
- **ConnectToBrowser**: è¿æ¥æµè§ˆå™¨å¹¶éªŒè¯ç™»å½•çŠ¶æ€

### æ¨èä¸æœç´¢
- **GetRecommendedNotes**: è·å–æ¨èç¬”è®°æµï¼ˆé›†æˆUniversalApiMonitorï¼‰

### æœç´¢å·¥å…·  
- **GetSearchNotes**: åŸºç¡€æœç´¢ç¬”è®°åŠŸèƒ½ï¼Œæ”¯æŒAPIç›‘å¬å’Œæ‹ŸäººåŒ–æ“ä½œç»“åˆ
  - é«˜çº§ç­›é€‰ï¼šæ’åºã€ç±»å‹ã€æ—¶é—´èŒƒå›´ã€æ˜¯å¦å¯¼å‡ºç­‰å‚æ•°
  - æ’åº: comprehensive(ç»¼åˆ), latest(æœ€æ–°), most_liked(æœ€å¤šç‚¹èµ)
  - ç±»å‹: all(ä¸é™), video(è§†é¢‘), image(å›¾æ–‡)  
  - æ—¶é—´: all(ä¸é™), day(ä¸€å¤©å†…), week(ä¸€å‘¨å†…), half_year(åŠå¹´å†…)
  - è‡ªåŠ¨åˆ†æå’ŒExcelå¯¼å‡ºåŠŸèƒ½

### ç”¨æˆ·èµ„æ–™å·¥å…·ï¼ˆå·²åºŸå¼ƒï¼‰
- ç›¸å…³å·¥å…·å·²ç§»é™¤ï¼›å¦‚éœ€å¯¼èˆªæˆ–è¿›å…¥å‘ç°é¡µï¼Œç”±æœåŠ¡å†…éƒ¨è‡ªåŠ¨å¤„ç†

### å†…å®¹è¯¦æƒ…å·¥å…·
- **GetNoteDetail**: åŸºäºå•ä¸ªå…³é”®è¯å®šä½å¹¶è·å–è¯¦ç»†ä¿¡æ¯ï¼ˆé›†æˆFeed/Comments APIç›‘å¬ï¼‰
- **BatchGetNoteDetails**: æ‰¹é‡è·å–ç¬”è®°è¯¦æƒ…ï¼ˆçº¯ç›‘å¬ä¸æ‹ŸäººåŒ–æ“ä½œç»“åˆï¼‰

### äº’åŠ¨å·¥å…·
- **PostComment**: å‘å¸ƒè¯„è®ºåˆ°æŒ‡å®šç¬”è®°
- **TemporarySaveAndLeave**: ä¿å­˜å†…å®¹ä¸ºè‰ç¨¿ï¼ˆå®‰å…¨æ¨¡å¼ï¼‰

> âœ¨ **æ¶æ„å‡çº§äº®ç‚¹**: æ‰€æœ‰æ•°æ®è·å–å·¥å…·ç°å‡é›†æˆäº†UniversalApiMonitorï¼Œæä¾›æ›´ç¨³å®šã€é«˜æ•ˆçš„APIæ•°æ®è·å–èƒ½åŠ›ã€‚

## âš™ï¸ é…ç½®ç®¡ç†

é¡¹ç›®ä½¿ç”¨â€œä»£ç å†…é»˜è®¤ + å¤–éƒ¨è¦†ç›–â€çš„æ–¹å¼ï¼Œä¸å†è¯»å– `appsettings.json`ï¼›
å¹¶ä¸”ä»…æ³¨å†Œä¸€ä¸ªé…ç½®ç±»ï¼š`XhsSettings`ï¼ˆæ ¹èŠ‚ `XHS`ï¼‰ã€‚å·²ç§»é™¤ `AddEnvironmentVariables("XHS__")` çš„å‰ç¼€è¿‡æ»¤ï¼Œç»Ÿä¸€åœ¨æ ¹èŠ‚ `XHS` ä¸‹è¯»å–ä¸è¦†ç›–ã€‚

è¦†ç›–æ–¹å¼ï¼ˆä¼˜å…ˆçº§ï¼šå‘½ä»¤è¡Œ > ç¯å¢ƒå˜é‡ > ä»£ç é»˜è®¤ï¼‰ï¼š
- ç¯å¢ƒå˜é‡ï¼šæ ¹èŠ‚ `XHS`ï¼ˆåŒä¸‹åˆ’çº¿ `__` æ˜ å°„ä¸ºå†’å· `:`ï¼‰ã€‚
  - ç¤ºä¾‹ï¼š`XHS__Serilog__MinimumLevel=Debug`ã€`XHS__BrowserSettings__Headless=true`
- å‘½ä»¤è¡Œå‚æ•°ï¼š`XHS:Section:Key=Value`
  - ç¤ºä¾‹ï¼š`XHS:Serilog:MinimumLevel=Debug XHS:PageLoadWaitConfig:MaxRetries=5`

é»˜è®¤é”®è§ `Program.cs` çš„ `CreateDefaultSettings()`ï¼š`XHS:Serilog`, `XHS:UniversalApiMonitor`, `XHS:BrowserSettings`, `XHS:McpSettings`, `XHS:PageLoadWaitConfig`, `XHS:SearchTimeoutsConfig`, `XHS:EndpointRetry`, `XHS:DetailMatchConfig`, `XHS:InteractionCache`ã€‚
DI ç»‘å®šï¼š`services.Configure<XhsSettings>(configuration.GetSection("XHS"))`ã€‚

### ç»Ÿä¸€ç­‰å¾…è¶…æ—¶é…ç½®ï¼ˆMCPï¼‰

- é”®åï¼š`XHS:McpSettings:WaitTimeoutMs`
- é»˜è®¤ï¼š`600000`ï¼ˆ10 åˆ†é’Ÿï¼‰
- è¦†ç›–ï¼šç¯å¢ƒå˜é‡ `XHS__McpSettings__WaitTimeoutMs` æˆ–å‘½ä»¤è¡Œ `XHS:McpSettings:WaitTimeoutMs`
- è¯´æ˜ï¼šä½œä¸ºæ‰€æœ‰é•¿è€—æ—¶æ“ä½œçš„ç»Ÿä¸€ç­‰å¾…æ—¶é•¿ï¼Œä¸é™åˆ¶ä¸Šé™ã€‚

### è¯¦æƒ…é¡µåŒ¹é…å‚æ•°ï¼ˆæƒé‡/æ¨¡ç³Š/æ‹¼éŸ³ï¼‰

- `DetailMatchConfig:WeightedThreshold`ï¼ˆé»˜è®¤ 0.5ï¼‰
- `DetailMatchConfig:UseFuzzy`ï¼ˆé»˜è®¤ trueï¼‰
- `DetailMatchConfig:MaxDistanceCap`ï¼ˆé»˜è®¤ 3ï¼‰
- `DetailMatchConfig:UsePinyin`ï¼ˆé»˜è®¤ trueï¼Œé¦–å­—æ¯å¯å‘å¼ï¼‰


### æŒ‰å‘½åç©ºé—´è¦†ç›–æ—¥å¿—ç­‰çº§
- é”®æ ¼å¼ï¼š`XHS:Logging:Overrides:<Namespace>=<Level>`ï¼ˆå¦‚ `Debug`/`Information`/`Warning`/`Error`ï¼‰
- ç¯å¢ƒå˜é‡ï¼š`XHS__Logging__Overrides__XiaoHongShuMCP.Services.UniversalApiMonitor=Debug`
- å‘½ä»¤è¡Œï¼š`XHS:Logging:Overrides:XiaoHongShuMCP.Services.PlaywrightBrowserManager=Information`

### MCP å®¢æˆ·ç«¯é…ç½® (Claude Desktop)

**é…ç½®æ–‡ä»¶ä½ç½®**:
- Windows: `%APPDATA%\Claude\claude_desktop_config.json`
- macOS: `~/Library/Application Support/Claude/claude_desktop_config.json`

**å¼€å‘ç¯å¢ƒé…ç½®**:
```json
{
  "mcpServers": {
    "xiaohongshu-mcp": {
      "command": "dotnet",
      "args": [
        "run",
        "--project", 
        "D:\\RiderProjects\\XiaoHongShuMCP\\XiaoHongShuMCP"
      ],
      "env": {
        "DOTNET_ENVIRONMENT": "Development"
      }
    }
  }
}
```

**ç”Ÿäº§ç¯å¢ƒé…ç½®**:
```json
{
  "mcpServers": {
    "xiaohongshu-mcp": {
      "command": "D:\\RiderProjects\\XiaoHongShuMCP\\XiaoHongShuMCP\\bin\\Release\\net8.0\\XiaoHongShuMCP.exe",
      "args": [],
      "env": {
        "DOTNET_ENVIRONMENT": "Production"
      }
    }
  }
}
```

## ğŸ§ª æµ‹è¯•ä½“ç³»

### æµ‹è¯•è¦†ç›–
- **æ€»æµ‹è¯•æ•°**: 67+ ä¸ªæµ‹è¯•ç”¨ä¾‹
- **é€šè¿‡ç‡**: 100%
- **è¦†ç›–æ¨¡å—**: æœåŠ¡å±‚ã€æ•°æ®æ¨¡å‹ã€MCP å·¥å…·

### æµ‹è¯•æ¡†æ¶
- **NUnit 4.4.0**: ä¸»æµ‹è¯•æ¡†æ¶
- **Moq 4.20.72**: Mock å¯¹è±¡æ¡†æ¶
- **Microsoft.Playwright 1.54.0**: æµè§ˆå™¨æµ‹è¯•æ”¯æŒ

### è¿è¡Œæµ‹è¯•
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
dotnet test Tests --verbosity minimal

# ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
dotnet test Tests --logger trx --results-directory TestResults
```

## ğŸ”’ å®‰å…¨ç‰¹æ€§

### å†…å®¹å®‰å…¨
- **ä»…è‰ç¨¿æ¨¡å¼**: æ‰€æœ‰å†…å®¹å‘å¸ƒæ“ä½œä»…ä¿å­˜ä¸ºè‰ç¨¿
- **ç”¨æˆ·æ§åˆ¶**: ç”¨æˆ·å®Œå…¨æ§åˆ¶å†…å®¹å‘å¸ƒæ—¶æœº
- **æ•°æ®è„±æ•**: æ—¥å¿—ä¸­æ•æ„Ÿä¿¡æ¯è„±æ•å¤„ç†

### é˜²æ£€æµ‹æœºåˆ¶  
- **æ‹ŸäººåŒ–æ“ä½œ**: æ¨¡æ‹ŸçœŸäººçš„ç‚¹å‡»ã€è¾“å…¥ã€æ»šåŠ¨è¡Œä¸º
- **éšæœºå»¶æ—¶**: åŠ¨æ€è°ƒæ•´æ“ä½œé—´éš”æ—¶é—´
- **å¤šé€‰æ‹©å™¨å®¹é”™**: åº”å¯¹é¡µé¢ç»“æ„å˜åŒ–

### æ•°æ®ä¿æŠ¤
- **æœ¬åœ°å¤„ç†**: æ‰€æœ‰æ•°æ®åœ¨æœ¬åœ°å¤„ç†ï¼Œä¸ä¸Šä¼ ç¬¬ä¸‰æ–¹
- **ä¼šè¯ç®¡ç†**: å®‰å…¨çš„æµè§ˆå™¨ä¼šè¯ç®¡ç†
- **é”™è¯¯å¤„ç†**: ä¼˜é›…çš„é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶

## ğŸ“ å¼€å‘æœ€ä½³å®è·µ

### ä»£ç è§„èŒƒ
- éµå¾ª .NET ç¼–ç è§„èŒƒå’Œå‘½åçº¦å®š
- ä½¿ç”¨ C# 9.0+ æ–°ç‰¹æ€§ (records, pattern matching ç­‰)
- å¯ç”¨ nullable reference types
- å®Œæ•´çš„ XML æ–‡æ¡£æ³¨é‡Š

### æ¶æ„åŸåˆ™
- **é€šç”¨APIç›‘å¬**: ä½¿ç”¨UniversalApiMonitorç»Ÿä¸€ç®¡ç†å¤šç«¯ç‚¹APIç›‘å¬
- **ä¾èµ–æ³¨å…¥**: ä½¿ç”¨ Microsoft.Extensions.DependencyInjection
- **æ™ºèƒ½è·¯ç”±**: APIå“åº”æ ¹æ®URLæ¨¡å¼è‡ªåŠ¨è·¯ç”±åˆ°å¯¹åº”å¤„ç†å™¨
- **æ¥å£éš”ç¦»**: æ¸…æ™°çš„æ¥å£å®šä¹‰å’Œå®ç°åˆ†ç¦»
- **å•ä¸€èŒè´£**: æ¯ä¸ªæœåŠ¡ç±»èŒè´£æ˜ç¡®
- **é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„ OperationResult<T> æ¨¡å¼
- **æ•°æ®è½¬æ¢**: ä¸“é—¨çš„è½¬æ¢å™¨å¤„ç†APIæ•°æ®æ ¼å¼åŒ–

### æ€§èƒ½ä¼˜åŒ–
- **å¼‚æ­¥ç¼–ç¨‹**: å…¨é¢ä½¿ç”¨ async/await æ¨¡å¼
- **èµ„æºç®¡ç†**: åŠæ—¶é‡Šæ”¾æµè§ˆå™¨å’Œæ–‡ä»¶èµ„æº
- **æ‰¹é‡å¤„ç†**: æ™ºèƒ½çš„æ‰¹é‡æ“ä½œæ¨¡å¼
- **ç¼“å­˜ç­–ç•¥**: åˆç†çš„é€‰æ‹©å™¨å’Œæ•°æ®ç¼“å­˜

## ğŸš€ éƒ¨ç½²è¯´æ˜

### å¼€å‘éƒ¨ç½²
1. é…ç½®æµè§ˆå™¨è¿œç¨‹è°ƒè¯•ç«¯å£ (9222)
2. è¿è¡Œ MCP æœåŠ¡å™¨: `dotnet run --project XiaoHongShuMCP`
3. é…ç½® Claude Desktop çš„ mcpServers
4. é‡å¯ Claude Desktop ä½¿é…ç½®ç”Ÿæ•ˆ

### ç”Ÿäº§éƒ¨ç½²
1. æ„å»ºå‘å¸ƒç‰ˆæœ¬: `dotnet publish -c Release`
2. éƒ¨ç½²åˆ°ç›®æ ‡æœåŠ¡å™¨
3. é…ç½®ç”Ÿäº§ç¯å¢ƒçš„ mcpServers è®¾ç½®
4. è®¾ç½®è‡ªåŠ¨å¯åŠ¨å’Œç›‘æ§

### æ•…éšœæ’é™¤
- æ£€æŸ¥æµè§ˆå™¨è¿œç¨‹è°ƒè¯•ç«¯å£æ˜¯å¦å¯è®¿é—®
- ç¡®è®¤å°çº¢ä¹¦ç™»å½•çŠ¶æ€æœ‰æ•ˆ  
- æŸ¥çœ‹ `logs/` ç›®å½•ä¸­çš„è¯¦ç»†æ—¥å¿—
- éªŒè¯ MCP å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶è¯­æ³•æ­£ç¡®

## ğŸ“š ä½¿ç”¨ç¤ºä¾‹

### è¿æ¥æµè§ˆå™¨
```typescript
// MCP å®¢æˆ·ç«¯è°ƒç”¨
await callTool("ConnectToBrowser", {});
```

### æ™ºèƒ½æœç´¢
```typescript
await callTool("GetSearchNotes", {
  keyword: "ç¾é£Ÿæ¨è",
  maxResults: 20,
  sortBy: "most_liked",
  noteType: "image",
  publishTime: "week"
});
```

### è·å–ç¬”è®°è¯¦æƒ…
```typescript
await callTool("GetNoteDetail", {
  keyword: "å¥èº«é¤",
  includeComments: true
});
```

---

**é¡¹ç›®çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª  
**æœ€åæ›´æ–°**: 2025å¹´9æœˆ11æ—¥  
**ç‰ˆæœ¬**: 1.0.0  
**ç»´æŠ¤è€…**: XiaoHongShuMCP Team
